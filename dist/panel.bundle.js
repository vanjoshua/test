(()=>{"use strict";var t={517:(t,e)=>{var n;Object.defineProperty(e,"__esModule",{value:!0}),e.EventType=void 0,function(t){t.removeAppCompleted="removeAppCompleted",t.componentSelectionChanged="componentSelectionChanged",t.appInstalled="appInstalled",t.appUpdateCompleted="appUpdateCompleted"}(n||(e.EventType=n={}))},845:function(t,e,n){var i=this&&this.__createBinding||(Object.create?function(t,e,n,i){void 0===i&&(i=n);var s=Object.getOwnPropertyDescriptor(e,n);s&&!("get"in s?!e.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,i,s)}:function(t,e,n,i){void 0===i&&(i=n),t[i]=e[n]}),s=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),o=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)"default"!==n&&Object.prototype.hasOwnProperty.call(t,n)&&i(e,t,n);return s(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.EventType=e.WixSDKTypes=void 0;const r=o(n(382));e.WixSDKTypes=r;var a=n(517);Object.defineProperty(e,"EventType",{enumerable:!0,get:function(){return a.EventType}})},382:(t,e,n)=>{function i(t,e=!1,n=t=>t){return()=>({__type:"event-definition",type:t,isDomainEvent:e,transformations:n})}function s(t,e){return{__type:"service-plugin-definition",componentType:t,methods:e}}n.r(e),n.d(e,{EventDefinition:()=>i,SERVICE_PLUGIN_ERROR_TYPE:()=>o,ServicePluginDefinition:()=>s});var o="wix_spi_error"}},e={};function n(i){var s=e[i];if(void 0!==s)return s.exports;var o=e[i]={exports:{}};return t[i].call(o.exports,o,o.exports,n),o.exports}n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};class i extends Error{state={};displayName;prefix;errorMessage;parent;messages=[];code;constructor(t,e,n){const s=`[${n}]#${e}`;super(`${s}.${t?` ${t}`:""}`),this.displayName=s,this.errorMessage=t,this.prefix=n,this.code=e,this.name=s,Object.defineProperty(this,"message",{get:()=>this.getDisplayMessage()}),Error.captureStackTrace&&Error.captureStackTrace(this,i)}get parentError(){const t=this.parent;if(!t)return null;if(this.parent instanceof i)return this.parent;const e=t.name??"[Unknown Error]";return{getBreadcrumbs:()=>[e],getMessage:()=>[e,t.message??"unknown error message"].join("\n")}}getDisplayMessage(){return[(this.parentError?this.getBreadcrumbs():[]).join(" -> "),this.getMessage()].filter((t=>t.trim().length)).join("\n")}getMessage(){const t=Object.entries(this.state).reduce(((t,[e,n])=>(n&&t.push(` – ${e}: ${n}`),t)),[]).join("\n"),e=this.messages.reduce(((t,e)=>(t.push(` - ${e.join(" ")}`),t)),[]).join("\n"),n=this.parentError;return[n?["",n.getMessage(),""].join("\n"):"",this.errorMessage?`${this.displayName}: ${this.errorMessage}`:this.displayName,t,e].filter((t=>t.trim().length)).join("\n")}getBreadcrumbs(){const t=this.parentError;return t?[...t.getBreadcrumbs(),this.displayName]:[this.displayName]}withParentError(t){return this.parent=t,this}withMessage(...t){return this.messages.push(t),this}}function s(t){return function e(n,i=""){const s=new t(i,n);return Error.captureStackTrace&&Error.captureStackTrace(s,e),s}}s(class extends i{state={};constructor(t,e){super(t,e,"Editor Platform Internal Error")}withHost(t){return this.state={...this.state,host:t},this}});var o=n(845);class r{static biEvents={PLATFORM_WORKER_SPAWN:123,PLATFORM_APP_RUNNER_INIT_APP_API:124,PLATFORM_APP_RUNNER_RUN_APP:125,PLATFORM_APP_RUNNER_REMOVE_APP:126,PLATFORM_WORKER_APP_BUNDLE_LOAD:127,PLATFORM_WORKER_APP_BUNDLE_EXECUTE:128,PLATFORM_IFRAME_INIT:129,PLATFORM_APP_API_INIT:130,PLATFORM_APP_API_GET:131};static EventSteps={Start:"start",End:"end",Error:"error"};uid=0;callbacks=new Map;inTransaction=!1;isSilent=!1;queue=[];silent(t=!0){this.isSilent=t}startTransaction(){this.inTransaction=!0}commit(){this.inTransaction=!1;const t=this.queue;this.queue=[],this.isSilent||t.forEach((t=>{this.notify(t)}))}notify(t){this.isSilent||(this.inTransaction?this.queue.push(t):this.callbacks.forEach((e=>{e(t)})))}subscribe(t){const e=this.uid++;return this.callbacks.set(e,t),()=>{this.callbacks.delete(e)}}notifyWithStep(t,e){this.notify({...t,meta:{...t.meta,step:e}})}async withEvent(t,e){let n=e();if(!n||!n.hasOwnProperty("then"))return this.notify(t),n;try{return this.notifyWithStep(t,r.EventSteps.Start),n=await n,this.notifyWithStep(t,r.EventSteps.End),n}catch(e){throw this.notifyWithStep({...t,meta:{...t.meta,error:e}},r.EventSteps.Error),e}}}var a=(t=>(t.WorkerSpawn="WorkerSpawn",t.HostEvent="HostEvent",t.ApplicationsSpecsReceived="ApplicationsSpecsReceived",t.InitApplicationApi="InitApplicationApi",t.RunApplication="RunApplication",t.getApplicationApi="getApplicationApi",t.IframeInit="IframeInit",t))(a||{}),c=(t=>(t.EditorReady="EditorReady",t))(c||{}),p=(t=>(t.ApplicationInit="ApplicationInit",t.ApplicationExecute="ApplicationExecute",t.ApplicationRemoved="ApplicationRemoved",t.ApplicationLoad="ApplicationLoad",t.ApplicationApiInit="ApplicationApiInit",t.CustomEvent="CustomEvent",t.HostEvent="HostEvent",t.EditorReady="EditorReady",t))(p||{});class l{createApplicationRemovedEvent(t){return{type:"ApplicationRemoved",payload:{appDefinitionId:t},meta:{bi:{evid:d.biEvents.PLATFORM_WORKER_SPAWN,appDefId:t}}}}createApplicationLoadEvent(t,e){return{type:"ApplicationLoad",payload:{appDefinitionId:t.appDefinitionId,url:e},meta:{bi:{evid:d.biEvents.PLATFORM_WORKER_APP_BUNDLE_LOAD,appDefId:t.appDefinitionId,appType:t.appType,bundleUrl:e}}}}createApplicationExecuteEvent(t,e){return{type:"ApplicationExecute",payload:{appDefinitionId:t.appDefinitionId,url:e},meta:{bi:{evid:d.biEvents.PLATFORM_WORKER_APP_BUNDLE_EXECUTE,appDefId:t.appDefinitionId,appType:t.appType,bundleUrl:e}}}}createApplicationApiInitEvent(t,e){return{type:"ApplicationApiInit",payload:{appDefinitionId:t},meta:{bi:{evid:d.biEvents.PLATFORM_APP_API_INIT,appDefId:t,scope:e}}}}}class d extends r{factories=new l}o.EventType.componentSelectionChanged,o.EventType.appInstalled,o.EventType.appUpdateCompleted,o.EventType.removeAppCompleted;const h=t=>`"editor-platform-transport": ${t}`,u=t=>h(`[Internal Error] ${t}`),m="_get_",v="_set_",y="+",f=t=>"×"===t[0]?"":t,g=t=>null==t||"symbol"==typeof t||"number"==typeof t||"boolean"==typeof t||"function"==typeof t||"string"==typeof t,w=t=>t.map(f).filter(Boolean).join(".");function E(t,e){return{marker:t,...e}}const A=E("A",{shouldUse:t=>Array.isArray(t),serialize:(t,e)=>{t.length?t.forEach(((t,n)=>{e(`${n}`,t)})):e("","°")},deserialize:{create:()=>[],has:(t,e)=>!(void 0===t[e]),append:(t,e,n)=>{t.push(n)}}}),I=E("M",{shouldUse:t=>t instanceof Map,serialize:(t,e)=>{t.forEach(((t,n)=>{e(n,t)}))},deserialize:{create:()=>new Map,has:(t,e)=>t.has(e),append:(t,e,n)=>{t.set(e,n)}}}),b=E("S",{shouldUse:t=>t instanceof Set,serialize:(t,e)=>{let n=0;t.forEach((t=>{e(""+n++,t)}))},deserialize:{create:()=>new Set,has:(t,e)=>t.has(e),append:(t,e,n)=>{t.add(n)}}}),x=E("O",{shouldUse:t=>"object"==typeof t,serialize:(t,e)=>{const n=i=>{const s=Reflect.ownKeys(i).filter((t=>"constructor"!==t)).filter((t=>"symbol"!=typeof t));s.length?s.filter((t=>"constructor"!==t)).filter((t=>"symbol"!=typeof t)).forEach((n=>{const i=Reflect.get(t,n);e(n,i)})):e("","°");const o=Reflect.getPrototypeOf(i);o&&!o?.hasOwnProperty("__proto__")&&n(o)};n(t)},deserialize:{create:()=>({}),has:(t,e)=>!!t[e],append:(t,e,n)=>{t[e]=n}}}),P=[A,b,I],_=(t,e)=>{if(!(n=t)||"object"!=typeof n||Array.isArray(n)||n instanceof Date||n instanceof Set||n instanceof Map)throw new Error(h("only objects are serializable at the root level"));var n;const i={data:[]},s=(t,e)=>{i.data.push([t,e])};return function(t,e){const n=new WeakMap,i=e=>{const n=e.slice(1).map(f).filter(Boolean);return n.slice(1).reduce(((t,e)=>({context:t.context[t.pointer],pointer:e})),{context:t,pointer:n[0]})},s=(t,o=[])=>{if(n.has(t)){const s=n.get(t)?.some((t=>o.join(".").startsWith(t)));if(s)return void e(o,{...i(o),value:"[Circular]"})}if(t&&!g(t)&&(n.has(t)&&n.set(t,[]),n.set(t,[...n.get(t)??[],o.join(".")])),g(t))return void e(o,{...i(o),value:t});const r=P.find((e=>e.shouldUse(t)))??x;r&&r.serialize(t,((t,e)=>{s(e,[...o,`×${r.marker}`,t])}))};s(t)}(t,((t,{value:n,context:i,pointer:o})=>{const r=t.slice(1).join("·"),a=function(t,e){let n=t;for(;n;){const t=Object.getOwnPropertyDescriptor(n,e);if(t)return t;n=Reflect.getPrototypeOf(n)}return null}(i,o);a?.get||a?.set?(a?.get&&e(w([...t,m]),(()=>i[o])),a?.set&&e(w([...t,v]),(t=>{i[o]=t})),s(r,`∂${[a?.get?y:"-",a?.set?y:"-"].join("")}`)):"function"==typeof n?((t,n)=>{e((t=>w(t.split("·")))(t),((...t)=>n.context[n.pointer](...t))),s(t,"ƒ")})(r,{context:i,pointer:o}):s(r,n)})),i};var T=(t=>(t.ExposeAPI="ExposeAPI",t.Call="Call",t.Response="Response",t.Cleanup="Cleanup",t))(T||{});class C{constructor(t,e){this.type=t,this.payload=e}correlationId=`M-${performance.now()}`;parentCorrelationId;withParentCorrelationId(t){return this.parentCorrelationId=t,this}serialize(t){return JSON.stringify({parentCorrelationId:this.parentCorrelationId,correlationId:this.correlationId,type:this.type,payload:_(this.payload,((e,n)=>{t(this.correlationId,e,n)}))})}static fromEvent(t,e){const n=JSON.parse(t);return new C(n.type,((t,e)=>"object"!=typeof t||null===t?t:t.data.reduce(((t,[n,i])=>{let s=t;const o=n.split("·");let r=x,a=null;for(let t=0;t<o.length;t++){const e=o[t];if("×"===e[0]){const t=r.deserialize.has(s,a);if(r=[x,...P].find((t=>t.marker===e[1])),!r)throw new Error(h(`unknown marker "${e[1]}"`));t||(s[a]=r.deserialize.create()),s=s[a]}else a=e}if("°"===i?.toString())return t;if("ƒ"===i?.toString())r.deserialize.append(s,a,e(w(o)));else if("∂"===i?.toString()[0]){const t=i?.toString()[1]===y,n=i?.toString()[2]===y,r={};if(t){const t=e(w([...o,m]));r.get=()=>t()}n&&(r.set=e(w([...o,v]))),Object.defineProperty(s,a,r)}else r.deserialize.append(s,a,i);return t}),{[Symbol("transferred object")]:`${(JSON.stringify(t.data).length/1024).toFixed(2)}Kb`}))(n.payload,(t=>e(n.correlationId,t)))).withParentCorrelationId(n.correlationId)}}class R extends C{constructor(t){super("Cleanup",t)}}class j extends C{constructor(t){super("Response",t)}}class D extends C{constructor(t){super("Response",t)}}class O extends C{constructor(t){super("Call",t)}}const M=(t,e)=>`${t}_${e}`;class S{constructor(t){this.handshake=t}#t=new FinalizationRegistry((t=>{this.postMessage(new R(t))}));#e={[T.Cleanup]:t=>{const e=t.payload.functionMarkerKey,n=t.payload.callId;delete this.#n[e],n&&delete this.#i[n]},[T.Response]:async t=>{const e=t.payload.callId,n=t.payload.errorMessage;if(n)if(t.payload.errorStack){const i=new Error(n);i.stack=t.payload.errorStack,this.#i[e]?.reject(i)}else this.#i[e]?.reject(n);else{const n=t.payload.response;this.#i[e]?.resolve(n)}delete this.#i[e]},[T.Call]:async t=>{const e=t.payload.functionMarkerKey,n=this.#n[e];if(n)try{const e=await n.value(...t.payload.props??[]);this.postMessage(new j({callId:t.payload.callId,response:e}))}catch(e){this.postMessage(new D({callId:t.payload.callId,errorMessage:e.message,errorStack:e.stack}))}else this.postMessage(new D({callId:t.payload.callId,errorMessage:h("function is not available")}))}};#n={};#i={};queue=[];isConnected=!1;async run(t){return this.handshake.run(t)}registerMessageListener(){if(!this.port)throw new Error(u("it is not possible to listen on port events because port is not defined"));this.port.onmessage=t=>{this.onMessage(t)}}onMessage(t){const e=C.fromEvent(t.data,((t,e)=>{const n=this.replaceTransferredFunction(t,e);return this.#t.register(n,{functionMarkerKey:M(t,e)}),n}));this.#e[e.type]?.(e),this.messageEvents[e.type]?.(e)}postMessage(t){if(!this.port)throw new Error(u("it is not possible to post message on port because port is not defined"));this.port.postMessage(t.serialize(this.registerTransferredFunction.bind(this)))}registerTransferredFunction(t,e,n){const i=M(t,e);this.#n[i]={path:e,value:n}}replaceTransferredFunction(t,e){return(...n)=>{const i=`CALL-${crypto.randomUUID()}`;return this.postMessage(new O({callId:i,functionMarkerKey:M(t,e),props:n})),new Promise(((t,e)=>{this.#i[i]={resolve:t,reject:e}}))}}flush(){this.port&&(this.queue.forEach((t=>{this.postMessage(t)})),this.queue=[])}}class k extends S{port=void 0;messageEvents={};constructor(t){super(t),this.init()}async init(){const t=await this.run();t?(this.port=t,this.registerMessageListener(),this.flush()):console.error(u("consumer did not receive message port from the host"))}expose(t){if(!t.type)throw new Error(h('wrong exposed API instance, "type" property is required'));this.queue.push(new C(T.ExposeAPI,t)),this.flush()}}class W{constructor(t){this.communicationAPI=t}}class N extends W{static iframe={host:t=>new N({postMessage:(e,n)=>{const i=t.contentWindow;i&&i.postMessage(e,"*",n)},onMessage:e=>{const n=n=>{n.origin===new URL(t.src).origin&&t.contentWindow===n.source&&e(n)};return globalThis.addEventListener("message",n),()=>globalThis.removeEventListener("message",n)}}),consumer:()=>new N({postMessage:t=>{globalThis.parent.postMessage(t,"*")},onMessage:t=>(globalThis.addEventListener("message",t),()=>{globalThis.removeEventListener("message",t)})})};static worker={host:t=>new N({postMessage:(e,n)=>{t.postMessage(e,n)},onMessage:e=>(t.addEventListener("message",e),()=>t.removeEventListener("message",e))}),consumer:()=>new N({postMessage:t=>{globalThis.postMessage(t)},onMessage:t=>(globalThis.addEventListener("message",t),()=>{globalThis.removeEventListener("message",t)})})};#s;#o=!1;run(t){return new Promise((e=>{t?this.#r(t,(()=>e(void 0))):this.#a(e)}))}#r(t,e){if(!t)throw new Error(u("port should exists on host handshake"));const n="Host";this.communicationAPI.postMessage(JSON.stringify({memberId:n,type:"Greeting"}),[]),this.#c(n,(i=>{switch(i.type){case"Greeting":this.communicationAPI.postMessage(JSON.stringify({memberId:n,type:"Greeting"}),[]);break;case"RequestPort":if(this.#o)return;this.#o=!0,this.communicationAPI.postMessage(JSON.stringify({memberId:n,type:"Port"}),[t]),this.#s?.(),e()}}))}#a(t){const e="Consumer";this.communicationAPI.postMessage(JSON.stringify({memberId:e,type:"Greeting"}),[]),this.#c(e,((n,i)=>{switch(n.type){case"Greeting":this.communicationAPI.postMessage(JSON.stringify({memberId:e,type:"RequestPort"}),[]);break;case"Port":this.#o=!0,this.#s?.(),t(i)}}))}#c(t,e){this.#s?.(),this.#s=this.communicationAPI.onMessage((n=>{try{const i="string"==typeof n.data?JSON.parse(n.data):{};if(!i.memberId||i.memberId===t)return;e(i,n.ports[0])}catch(t){console.error(t)}}))}}class $ extends k{constructor(){super(N.iframe.consumer())}}class L extends k{constructor(){super(N.worker.consumer())}}var F={},U=n(382);const q=t=>{switch(t){case"get":case"GET":return"GET";case"post":case"POST":return"POST";case"put":case"PUT":return"PUT";case"delete":case"DELETE":return"DELETE";case"patch":case"PATCH":return"PATCH";case"head":case"HEAD":return"HEAD";case"options":case"OPTIONS":return"OPTIONS";default:throw new Error(`Unknown method: ${t}`)}},H="www.wixapis.com";class J extends Error{message;response;constructor(t,e){super(t),this.message=t,this.response=e}async details(){const t=await this.response.json();return K(this.response.status,t?.message,t?.details,{requestId:this.response.headers.get("X-Wix-Request-Id"),details:t})}}const K=(t,e,n,i)=>({details:{...!n?.validationError&&{applicationError:{description:e,code:t,data:i}},...n},message:e}),z=t=>t&&"object"==typeof t&&!Array.isArray(t),B="x-wix-bi-gateway",G=(t,e)=>H;const V=(t,e,n,i)=>({response:{data:{details:{...!n?.validationError&&{applicationError:{description:e,code:t,data:i}},...n},message:e},status:t}});let X=()=>({emit(t,...e){for(let n=0,i=this.events[t]||[],s=i.length;n<s;n++)i[n](...e)},events:{},on(t,e){return(this.events[t]||=[]).push(e),()=>{this.events[t]=this.events[t]?.filter((t=>e!==t))}}});function Y(t,e,n,i){let s;if(t.isDomainEvent){const t=n,{deletedEvent:e,actionEvent:o,createdEvent:r,updatedEvent:a,...c}=t,p={...i,...c};s=e?e?.deletedEntity?{entity:e?.deletedEntity,metadata:p}:{metadata:p}:o?{data:o.body,metadata:p}:{entity:r?.entity??a?.currentEntity,metadata:p}}else s={data:n,metadata:i};return e((t.transformations??(t=>t))(s))}function Q(t){const e=t.headers||{Authorization:""},n=t.auth||{getAuthHeaders:t=>Promise.resolve({headers:{}})},i=n.getAuthHeaders.bind(void 0,t.host);n.getAuthHeaders=i;const{client:s,initModule:o}=function(t){const e=new Map,n=X();return{initModule:t=>i=>{const s=e.get(t.componentType.toLowerCase())??[];s.push({servicePluginDefinition:t,implementation:i}),e.set(t.componentType.toLowerCase(),s),n.emit("registered",t)},client:{...n,getRegisteredServicePlugins:()=>e,async parseJWT(e){if(!t.decodeJWT)throw new Error("decodeJWT is not supported by the authentication strategy");const{decoded:n,valid:i}=await t.decodeJWT(e,!0);if(!i)throw new Error("JWT is not valid");if("object"!=typeof n.data||null===n.data||!("metadata"in n.data)||"object"!=typeof n.data.metadata||null===n.data.metadata||!("appExtensionType"in n.data.metadata)||"string"!=typeof n.data.metadata.appExtensionType)throw new Error("Unexpected JWT data: expected object with metadata.appExtensionType string");return n.data},async process(t){const e=await this.parseJWT(t.body);return this.executeHandler(e,t.url)},async parseRequest(t){const e=await t.text();return this.parseJWT(e)},async processRequest(t){const e=t.url,n=await t.text(),i=await this.process({url:e,body:n});return Response.json(i)},async executeHandler(t,n){const i=t.metadata.appExtensionType.toLowerCase(),s=e.get(i)??[];if(0===s.length)throw new Error(`No service plugin implementations found for component type ${i}`);if(s.length>1)throw new Error(`Multiple service plugin implementations found for component type ${i}. This is currently not supported`);const{implementation:o,servicePluginDefinition:r}=s[0],a=r.methods.find((t=>n.endsWith(t.primaryHttpMappingPath)));if(!a)throw new Error("Unexpect request: request url did not match any method: "+n);const c=o[a.name];if(!c)throw new Error(`Got request for service plugin method ${a.name} but no implementation was provided. Available methods: ${Object.keys(o).join(", ")}`);return a.transformations.toREST(await c(a.transformations.fromREST(t)))}}}}(n),{client:r,initModule:a}=function(t){const e=new Map,n=X();return{initModule:t=>i=>{const s=e.get(t.type)??[];s.push({eventDefinition:t,handler:i}),e.set(t.type,s),n.emit("registered",t)},client:{...n,getRegisteredEvents:()=>e,async process(t,n={expectedEvents:[]}){const{eventType:i,identity:s,instanceId:o,payload:r}=await this.parseJWT(t),a=[...n.expectedEvents,...Array.from(e.keys()).map((t=>({type:t})))];if(a.length>0&&!a.some((({type:t})=>t===i)))throw new Error(`Unexpected event type: ${i}. Expected one of: ${a.map((t=>t.type)).join(", ")}`);const c=e.get(i)??[];return await Promise.all(c.map((({eventDefinition:t,handler:e})=>Y(t,e,r,{instanceId:o,identity:s})))),{instanceId:o,eventType:i,payload:r,identity:s}},async processRequest(t,e){const n=await t.text();return this.process(n,e)},async parseJWT(e){if(!t.decodeJWT)throw new Error("decodeJWT is not supported by the authentication strategy");const{decoded:n,valid:i}=await t.decodeJWT(e);if(!i)throw new Error("JWT is not valid");if("string"!=typeof n.data)throw new Error("Unexpected type of JWT data: expected string, got "+typeof n.data);const s=JSON.parse(n.data),o=s.eventType,r=s.instanceId,a=s.identity?JSON.parse(s.identity):void 0;return{instanceId:r,eventType:o,payload:JSON.parse(s.data),identity:a}},async parseRequest(t){const e=await t.text();return this.parseJWT(e)},async executeHandlers(t){const n=Array.from(e.keys()).map((t=>({type:t})));if(n.length>0&&!n.some((({type:e})=>e===t.eventType)))throw new Error(`Unexpected event type: ${t.eventType}. Expected one of: ${n.map((t=>t.type)).join(", ")}`);const i=e.get(t.eventType)??[];await Promise.all(i.map((({eventDefinition:e,handler:n})=>Y(e,n,t.payload,{instanceId:t.instanceId,identity:t.identity}))))},apps:{AppInstalled:(0,U.EventDefinition)("AppInstalled")(),AppRemoved:(0,U.EventDefinition)("AppRemoved")()}}}}(n),c=async(t,n)=>{const s=await i(),o=(t=>t?.method&&["post","put","patch"].includes(t.method.toLocaleLowerCase())&&t.body?{"Content-Type":"application/json"}:{})(n);return fetch(t,{...n,headers:{...o,...e,...s?.headers,...n?.headers}})},p=(e,n)=>{if("event-definition"===e.__type)return a(e);if("service-plugin-definition"===e.__type)return o(e);var i;if((t=>z(t)&&"host"===t.__type)(e)&&t.host)return function(t,e){return t.create(e)}(e,t.host);if("function"==typeof e){if("__type"in e&&e.__type===U.SERVICE_PLUGIN_ERROR_TYPE)return e;const{module:t,options:s}=(t=>{if(t.__isAmbassador)return!0;const e=t();return Boolean(e.__isAmbassador)})(e)?{module:(i=e,t=>async e=>{let n;const s=t=>{if(n=i(e)(t),void 0===n.url)throw new Error("Url was not successfully created for this request, please reach out to support channels for assistance.");const{method:s,url:o,params:r}=n;return{...n,method:q(s),url:o,data:n.data,params:r}};try{const e=await t.request(s);if(void 0===n)throw new Error("Request options were not created for this request, please reach out to support channels for assistance.");const i=Array.isArray(n.transformResponse)?n.transformResponse:[n.transformResponse];let o=e.data;return i.forEach((t=>{t&&(o=t(e.data,e.headers))})),o}catch(t){if("object"==typeof t&&null!==t&&"response"in t&&"object"==typeof t.response&&null!==t.response&&"data"in t.response)throw t.response.data;throw t}}),options:{HTTPHost:self.location.host}}:{module:e,options:void 0};return function(t,e,n,i,s){return t({request:async t=>{const i=t({host:s?.HTTPHost||H});let o=i;"GET"===o.method&&o.fallback?.length&&o.params.toString().length>4e3&&(o=i.fallback[0]);let r=`https://${s?.HTTPHost??G(o.method,o.url)}${o.url}`;o.params&&o.params.toString()&&(r+=`?${o.params.toString()}`);try{const t=function(t,e){return{[B]:(n={environment:"js-sdk","package-name":t.packageName??e?.PACKAGE_NAME,"method-fqn":t.methodFqn,entity:t.entityFqdn},Object.entries(n).filter((([t,e])=>Boolean(e))).map((([t,e])=>`${t}=${e}`)).join(","))};var n}(i,e),s=await n(r,{method:o.method,...o.data&&{body:JSON.stringify(o.data)},headers:{...t}});if(200!==s.status){let t=null;try{t=await s.json()}catch(t){}throw V(s.status,t?.message,t?.details,{requestId:s.headers.get("X-Wix-Request-Id"),details:t})}return{data:await s.json(),headers:s.headers,status:s.status,statusText:s.statusText}}catch(t){throw t.message?.includes("fetch is not defined")&&console.error("Node.js v18+ is required"),t}},fetchWithAuth:n,wixAPIFetch:i})}(t,n??{},c,((t,e)=>{const n=new URL(t,`https://${H}`);return n.host=H,n.protocol="https",c(n.toString(),e)}),s)}return z(e)?Object.fromEntries(Object.entries(e).map((([t,n])=>[t,p(n,e.__metadata)]))):e};return{...t.modules?p(t.modules):{},auth:n,setHeaders:t=>{for(const n in t)e[n]=t[n]},use:p,enableContext(t,e={elevated:!1}){"global"===t?null!=globalThis.__wix_context__?e.elevated?globalThis.__wix_context__.elevatedClient=this:globalThis.__wix_context__.client=this:e.elevated?globalThis.__wix_context__={elevatedClient:this}:globalThis.__wix_context__={client:this}:e.elevated?F.elevatedClient=this:F.client=this},fetch:(t,e)=>{const n=new URL(t,`https://${H}`);return n.host=H,n.protocol="https",c(n.toString(),e)},fetchWithAuth:async(t,e)=>{if("string"==typeof t||t instanceof URL)return fetch(t,{...e,headers:{...e?.headers,...(await i()).headers}});for(const[e,n]of Object.entries((await i()).headers))t.headers.set(e,n);return fetch(t,e)},async graphql(t,e,n={apiVersion:"alpha"}){const i=await c(`https://${H}/graphql/${n.apiVersion}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:t,variables:e})});if(200!==i.status)throw new J(`GraphQL request failed with status ${i.status}`,i);const{data:s,errors:o}=await i.json();return{data:s??{},errors:o}},webhooks:r,servicePlugins:s}}class Z{constructor(t){this.platformAppEvents=t}notify(t){switch(t.type){case c.EditorReady:this.platformAppEvents.notify({...t,type:p.EditorReady});break;case a.HostEvent:this.platformAppEvents.notify({...t,type:p.HostEvent})}}subscribe(t){this.platformAppEvents.subscribe((e=>{t(e)}))}}var tt=(t=>(t.Frame="PLATFORM_FRAME_API",t.Worker="PLATFORM_WORKER_API",t))(tt||{});class et{constructor(t){this.env=t,this.create()}}var nt=(t=>(t.IncorrectEnvironment="IncorrectEnvironment",t.ClientAuthError="ClientAuthError",t))(nt||{});const it=s(class extends i{state={};constructor(t,e){super(t,e,"Editor Platform Application Context Error")}withUrl(t){return this.state={...this.state,url:t},this}withAppDefinitionId(t){return this.state={...this.state,appDefinitionId:t},this}});class st{constructor(t,e,n){this.appDefinitionId=t,this.privateAPI=n,this.events=e,this.subscribe=e.subscribe.bind(e),this.commit=e.commit.bind(e),this.startTransaction=e.startTransaction.bind(e),this.silent=e.silent.bind(e)}events;subscribe;commit;startTransaction;silent;notify(t){this.events.notify({type:t.type,payload:t.payload,meta:{appDefinitionId:this.appDefinitionId}})}notifyCustomEvent(t,e){this.notify({type:p.CustomEvent,payload:{...e,type:t}})}addEventListener(t,e){return this.events.subscribe((async n=>{const i=n.meta?.appDefinitionId===this.appDefinitionId||null===n.meta?.appDefinitionId,s=()=>async function(t,e){if(!t?.type)return t;if("componentSelectionChanged"===t.type){const n=t.componentRefs||[],i=await Promise.all(n.map((t=>e.components.getComponent(t))));return{type:t.type,components:i}}return t}(n.payload,this.privateAPI);"*"===t?e(await s()):n.type===p.CustomEvent?t!==n.payload?.type||i||e(await s()):n.type===p.HostEvent&&t===n.payload?.type&&i&&e(await s())}))}}class ot{_resolveContextInjected=()=>{};_isInjected=!1;key;constructor(t){this.key=`__${t}_CONTEXT_INJECTION_STATUS_KEY`,globalThis[this.key]||(globalThis[this.key]=new Promise((t=>{this._resolveContextInjected=()=>{this._isInjected=!0,t()}})))}isInjected(){return!!this._isInjected}resolveInjected(){this._resolveContextInjected?.()}waitInjected(){return new Promise(((t,e)=>{let n,i=!1,s=0;const o=()=>{i||(n=setTimeout((()=>{if(s++,s<50)return s%10==0&&console.log(it(nt.IncorrectEnvironment,"contexts are not resolved, still re-trying").withMessage(`try number ${s}`).message),void o();if(!i){const t=it(nt.IncorrectEnvironment,"contexts are not resolved, threw by timeout");e(t)}}),200))};o(),globalThis[this.key].then((()=>{i=!0,clearTimeout(n),t()}))}))}}const rt="__ENVIRONMENT_CONTEXT_KEY";var at=(t=>(t.Worker="Worker",t.Frame="Frame",t.ComponentPanel="ComponentPanel",t))(at||{});class ct{constructor(t){this.environmentContext=t}static status=new ot("environment");static async inject(t){if(globalThis[rt])throw it(nt.IncorrectEnvironment,"Environment context already exists and should not be overridden");globalThis[rt]=new ct(t),this.status.resolveInjected()}static async getInstance(){return await this.status.waitInjected(),globalThis[rt]}getPrivateAPI(){return this.environmentContext.privateApi}getEvents(){return this.environmentContext.events}getApplicationAPIs(){return this.environmentContext.applicationAPIs??{}}getEnvironment(){return this.environmentContext.environment}}const pt="__APPLICATION_CONTEXT_KEY";class lt{constructor(t,e){this.applicationContext=t,this.environment=e,this.events=new st(this.applicationContext.appDefinitionId,this.environment.getEvents(),this.environment.getPrivateAPI())}static status=new ot("application");static async inject(t){if((await ct.getInstance()).getEnvironment()!==at.Frame)throw it(nt.IncorrectEnvironment,"Application context can be injected only in frame environment");if(globalThis[pt])throw it(nt.IncorrectEnvironment,"Application context already exists and should not be overridden");globalThis[pt]=new lt(t,await ct.getInstance()),this.status.resolveInjected()}static async getInstance(){return(await ct.getInstance()).getEnvironment()===at.Frame?(await this.status.waitInjected(),globalThis[pt]):__APPLICATION_CONTEXT_KEY}events;getAppDefinitionId(){return this.applicationContext.appDefinitionId}getBindings(){return this.applicationContext}getEvents(){return this.events}getPrivateAPI(){return this.environment.getPrivateAPI()}getPrivateApplicationAPI(){const t=this.getAppDefinitionId();if(!t)throw it(nt.IncorrectEnvironment,"appDefinitionId is not available");return this.environment.getApplicationAPIs()[t]}}const dt=t=>{const e=new ct({environment:t.environment,privateApi:t.privateAPI,events:t.events??new d,applicationAPIs:t.applicationPrivateAPI?{[t.appDefinitionId]:t.applicationPrivateAPI}:{}});return{environment:{},channel:{observeState:async()=>({disconnect(){}})},environmentContext:e,applicationContext:new lt({appDefinitionId:t.appDefinitionId,appDefinitionName:""},e)}},ht=(t,e)=>({getAuthHeaders:async()=>{if(!t)throw it(nt.ClientAuthError);const n=await e.info.getAppInstance(t);if(void 0===n)throw it(nt.ClientAuthError,"empty auth instance").withAppDefinitionId(t);return{headers:{Authorization:n}}}}),ut={classic:"https://www.unpkg.com/@wix/design-system/dist/statics/tokens-default.global.css",studio:"https://www.unpkg.com/@wix/design-system/dist/statics/tokens-studio.global.css"};class mt extends et{type=tt.Frame;#p=new d;#l=new Z(this.#p);#d;#h;constructor(){super(tt.Frame)}create(){if("function"==typeof globalThis?.document?.head?.prepend){const t="CLASSIC"===new URL(globalThis.location.href).searchParams.get("editorType")?"classic":"studio",e=ut[t],n=e&&!!document.querySelectorAll(`link[type="text/css"][href="${e}"]`)?.length;if(e&&!n){const t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),t.setAttribute("href",e),globalThis.document.head.prepend(t)}}}async initEnvironment(t){const{applicationPrivateAPI:e,privateAPI:n,appDefinitionId:i}=t;this.#h=e,this.#d=n,await ct.inject({environment:at.Frame,privateApi:n,events:this.#p,applicationAPIs:{[i]:this.#h}}),await lt.inject({appDefinitionId:i,appDefinitionName:""}),Q({auth:ht(i,n),host:dt({appDefinitionId:i,privateAPI:this.#d,environment:at.Frame,events:this.#p,applicationPrivateAPI:this.#h})}).enableContext("global")}notify(t){this.#l.notify(t)}subscribe(t){this.#l.subscribe(t)}}class vt{constructor(t){this.platformAppEvents=t}notify(t){switch(t.type){case c.EditorReady:this.platformAppEvents.notify({...t,type:p.EditorReady});break;case a.HostEvent:this.platformAppEvents.notify({...t,type:p.HostEvent})}}subscribe(t){this.platformAppEvents.subscribe((e=>{t(e)}))}}var yt=(t=>(t.IncorrectEnvironment="IncorrectEnvironment",t.ClientAuthError="ClientAuthError",t))(yt||{});const ft=s(class extends i{state={};constructor(t,e){super(t,e,"Editor Platform Application Context Error")}withUrl(t){return this.state={...this.state,url:t},this}withAppDefinitionId(t){return this.state={...this.state,appDefinitionId:t},this}});class gt{constructor(t,e,n){this.appDefinitionId=t,this.privateAPI=n,this.events=e,this.subscribe=e.subscribe.bind(e),this.commit=e.commit.bind(e),this.startTransaction=e.startTransaction.bind(e),this.silent=e.silent.bind(e)}events;subscribe;commit;startTransaction;silent;notify(t){this.events.notify({type:t.type,payload:t.payload,meta:{appDefinitionId:this.appDefinitionId}})}notifyCustomEvent(t,e){this.notify({type:p.CustomEvent,payload:{...e,type:t}})}addEventListener(t,e){return this.events.subscribe((async n=>{const i=n.meta?.appDefinitionId===this.appDefinitionId||null===n.meta?.appDefinitionId,s=()=>async function(t,e){if(!t?.type)return t;if("componentSelectionChanged"===t.type){const n=t.componentRefs||[],i=await Promise.all(n.map((t=>e.components.getComponent(t))));return{type:t.type,components:i}}return t}(n.payload,this.privateAPI);"*"===t?e(await s()):n.type===p.CustomEvent?t!==n.payload?.type||i||e(await s()):n.type===p.HostEvent&&t===n.payload?.type&&i&&e(await s())}))}}class wt{_resolveContextInjected=()=>{};_isInjected=!1;key;constructor(t){this.key=`__${t}_CONTEXT_INJECTION_STATUS_KEY`,globalThis[this.key]||(globalThis[this.key]=new Promise((t=>{this._resolveContextInjected=()=>{this._isInjected=!0,t()}})))}isInjected(){return!!this._isInjected}resolveInjected(){this._resolveContextInjected?.()}waitInjected(){return new Promise(((t,e)=>{let n,i=!1,s=0;const o=()=>{i||(n=setTimeout((()=>{if(s++,s<50)return s%10==0&&console.log(ft(yt.IncorrectEnvironment,"contexts are not resolved, still re-trying").withMessage(`try number ${s}`).message),void o();if(!i){const t=ft(yt.IncorrectEnvironment,"contexts are not resolved, threw by timeout");e(t)}}),200))};o(),globalThis[this.key].then((()=>{i=!0,clearTimeout(n),t()}))}))}}const Et="__ENVIRONMENT_CONTEXT_KEY";var At=(t=>(t.Worker="Worker",t.Frame="Frame",t.ComponentPanel="ComponentPanel",t))(At||{});class It{constructor(t){this.environmentContext=t}static status=new wt("environment");static async inject(t){if(globalThis[Et])throw ft(yt.IncorrectEnvironment,"Environment context already exists and should not be overridden");globalThis[Et]=new It(t),this.status.resolveInjected()}static async getInstance(){return await this.status.waitInjected(),globalThis[Et]}getPrivateAPI(){return this.environmentContext.privateApi}getEvents(){return this.environmentContext.events}getApplicationAPIs(){return this.environmentContext.applicationAPIs??{}}getEnvironment(){return this.environmentContext.environment}}const bt="__APPLICATION_CONTEXT_KEY";class xt{constructor(t,e){this.applicationContext=t,this.environment=e,this.events=new gt(this.applicationContext.appDefinitionId,this.environment.getEvents(),this.environment.getPrivateAPI())}static status=new wt("application");static async inject(t){if((await It.getInstance()).getEnvironment()!==At.Frame)throw ft(yt.IncorrectEnvironment,"Application context can be injected only in frame environment");if(globalThis[bt])throw ft(yt.IncorrectEnvironment,"Application context already exists and should not be overridden");globalThis[bt]=new xt(t,await It.getInstance()),this.status.resolveInjected()}static async getInstance(){return(await It.getInstance()).getEnvironment()===At.Frame?(await this.status.waitInjected(),globalThis[bt]):__APPLICATION_CONTEXT_KEY}events;getAppDefinitionId(){return this.applicationContext.appDefinitionId}getBindings(){return this.applicationContext}getEvents(){return this.events}getPrivateAPI(){return this.environment.getPrivateAPI()}getPrivateApplicationAPI(){const t=this.getAppDefinitionId();if(!t)throw ft(yt.IncorrectEnvironment,"appDefinitionId is not available");return this.environment.getApplicationAPIs()[t]}}const Pt=t=>{const e=new It({environment:t.environment,privateApi:t.privateAPI,events:t.events??new d,applicationAPIs:t.applicationPrivateAPI?{[t.appDefinitionId]:t.applicationPrivateAPI}:{}});return{environment:{},channel:{observeState:async()=>({disconnect(){}})},environmentContext:e,applicationContext:new xt({appDefinitionId:t.appDefinitionId,appDefinitionName:""},e)}},_t=(t,e)=>({getAuthHeaders:async()=>{if(!t)throw ft(yt.ClientAuthError);const n=await e.info.getAppInstance(t);if(void 0===n)throw ft(yt.ClientAuthError,"empty auth instance").withAppDefinitionId(t);return{headers:{Authorization:n}}}});var Tt=(t=>(t.ApplicationRuntimeError="ApplicationRuntimeError",t.ApplicationCreationError="ApplicationCreationError",t.ApplicationLoadError="ApplicationLoadError",t.ApplicationFetchError="ApplicationFetchError",t.ApplicationExecuteError="ApplicationExecuteError",t.ApplicationWasRemoved="ApplicationWasRemoved",t.UndefinedApiMethod="UndefinedApiMethod",t.ApplicationIsNotMutable="ApplicationIsNotMutable",t.FailedToGetPrivateAPI="FailedToGetPrivateAPI",t.ClientAuthError="ClientAuthError",t))(Tt||{});const Ct=s(class extends i{state={};constructor(t,e){super(t,e,"Editor Platform Application Error")}withUrl(t){return this.state={...this.state,url:t},this}withAppDefinitionId(t){return this.state={...this.state,appDefinitionId:t},this}withApiMethod(t){return this.state={...this.state,apiMethod:t},this}withApiType(t){return this.state={...this.state,apiType:t},this}});class Rt{#u={};#d;#p;constructor(t,e){this.#d=t,this.#p=e,this.#p.subscribe((t=>{t.type===p.HostEvent&&t.payload.type===o.EventType.removeAppCompleted&&this.#p.withEvent(this.#p.factories.createApplicationRemovedEvent(t.payload.appDefinitionId),(()=>this.removeApplication(t.payload.appDefinitionId)))}))}async runApplication(t){const e=await this.loadApplication(t),n=await this.executeApplication(t,e);return this.setApplication(t.appDefinitionId,n),n}setApplication(t,e){this.#u[t]=e,this.#p.withEvent(this.#p.factories.createApplicationApiInitEvent(t,e?.api?.private?"private":"public"),(()=>{this.#d.applicationManager.setApplication(e)}))}getApplication(t){return this.#u[t]}getAppDefinitionIds(){return Object.keys(this.#u)}removeApplication(t){delete this.#u[t]}async loadApplication(t){const e=t.url;return this.#p.withEvent(this.#p.factories.createApplicationLoadEvent(t,e),(async()=>{try{return await this.loadApplicationBundle(e)}catch(n){throw Ct(Tt.ApplicationLoadError).withUrl(e).withAppDefinitionId(t.appDefinitionId).withParentError(n)}}))}async loadApplicationBundle(t){const e=await fetch("url",{method:"GET"});if(!(e.status>=200&&e.status<=299))throw Ct(Tt.ApplicationFetchError).withUrl(t);return e.text()}async executeApplication(t,e){return this.#p.withEvent(this.#p.factories.createApplicationExecuteEvent(t,t.url),(async()=>{const n=this.#m(t.appDefinitionId),{instance:i}=await async function(t,e,n,i){const s=new Function("$wixContext",bt,"__APPLICATION_REGISTRY_KEY",i);let o;const r=t=>{if(o)throw Ct(Tt.ApplicationExecuteError,"Application registry called more than once").withAppDefinitionId(n.appDefinitionId);if(t.type!==n.type)throw Ct(Tt.ApplicationExecuteError,"Application has different type").withMessage("expected type",n.type).withMessage("received type",t.type);o=t};try{const t={...n};s.call({client:e},new xt(t,await It.getInstance()),r)}catch(t){throw Ct(Tt.ApplicationExecuteError,t.message).withAppDefinitionId(n.appDefinitionId).withParentError(t)}return new Promise(((e,i)=>{const s=t.subscribe((t=>{const r=setTimeout((()=>{clearTimeout(r),s(),o||i(Ct(Tt.ApplicationExecuteError,"Application registry was not called, threw by timeout").withAppDefinitionId(n.appDefinitionId))}),5e3);t.type===p.ApplicationInit&&t.meta.appDefinitionId===n.appDefinitionId&&(clearTimeout(r),s(),o||i(Ct(Tt.ApplicationExecuteError,"Application registry was not called").withAppDefinitionId(n.appDefinitionId)),e({instance:o}))}))}))}(this.#p,n,t,e);return i}))}#m(t){return Q({auth:_t(t,this.#d),host:Pt({appDefinitionId:t,privateAPI:this.#d,environment:At.Worker,events:this.#p,applicationPrivateAPI:{}})})}}var jt=(t=>(t.Frame="PLATFORM_FRAME_API",t.Worker="PLATFORM_WORKER_API",t))(jt||{});class Dt{constructor(t){this.env=t,this.create()}}class Ot extends Dt{type=jt.Worker;#p=new d;#l=new vt(this.#p);#v=null;#d;#y=[];constructor(){super(jt.Worker)}create(){}async initEnvironment(t){const{buildPrivateAPI:e}=t;this.#d=await e({type:"EDITOR_ADDON"}),await It.inject({environment:At.Worker,events:this.#p,privateApi:this.#d,applicationAPIs:{}}),this.#v=new Rt(this.#d,this.#p),this.#y.forEach((t=>t(this)))}async notify(t){await this.waitReady(),this.#l.notify(t)}subscribe(t){this.#l.subscribe(t)}async runApplication(t){await this.waitReady(),await this.#v.runApplication(t)}waitReady(){return new Promise((t=>{if(this.#d)return t(this);this.#y.push(t)}))}}function Mt(t){const e=globalThis.__wix_context__,n={client:F.client,elevatedClient:F.elevatedClient};let i;globalThis.__wix_context__=void 0,F.client=void 0,F.elevatedClient=void 0,"undefined"!=typeof $wixContext&&(i={client:$wixContext?.client,elevatedClient:$wixContext?.elevatedClient},delete $wixContext.client,delete $wixContext.elevatedClient);try{return t()}finally{globalThis.__wix_context__=e,F.client=n.client,F.elevatedClient=n.elevatedClient,"undefined"!=typeof $wixContext&&($wixContext.client=i.client,$wixContext.elevatedClient=i.elevatedClient)}}function St(t){return e={__type:"host",create:e=>Object.entries(t).reduce(((t,[n,i])=>({...t,[n]:i(e)})),{})},n=Object.keys(t),{...e,...Object.fromEntries(n.map((t=>[t,(...n)=>{const i=function(){const t="undefined"!=typeof $wixContext&&$wixContext.initWixModules?$wixContext.initWixModules:void 0!==globalThis.__wix_context__&&globalThis.__wix_context__.initWixModules?globalThis.__wix_context__.initWixModules:void 0;if(t)return{initWixModules:(e,n)=>Mt((()=>t(e,n))),fetchWithAuth(){throw new Error("fetchWithAuth is not available in this context")},graphql(){throw new Error("graphql is not available in this context")}};const e="undefined"!=typeof $wixContext?$wixContext.client:void 0!==F.client?F.client:void 0!==globalThis.__wix_context__?globalThis.__wix_context__.client:void 0,n="undefined"!=typeof $wixContext?$wixContext.elevatedClient:void 0!==F.elevatedClient?F.elevatedClient:void 0!==globalThis.__wix_context__?globalThis.__wix_context__.elevatedClient:void 0;return e||n?{initWixModules(t,i){if(i){if(!n)throw new Error("An elevated client is required to use elevated modules. Make sure to initialize the Wix context with an elevated client before using elevated SDK modules");return Mt((()=>n.use(t)))}if(!e)throw new Error("Wix context is not available. Make sure to initialize the Wix context before using SDK modules");return Mt((()=>e.use(t)))},fetchWithAuth:(t,n)=>{if(!e)throw new Error("Wix context is not available. Make sure to initialize the Wix context before using SDK modules");return e.fetchWithAuth(t,n)},async graphql(t,n,i){if(!e)throw new Error("Wix context is not available. Make sure to initialize the Wix context before using SDK modules");return e.graphql(t,n,i)}}:void 0}();if(!i)throw new Error("Wix context is not available. Make sure to initialize the Wix context before using SDK modules");return i.initWixModules(e)[t].apply(void 0,n)}])))};var e,n}var kt=(t=>(t.IncorrectEnvironment="IncorrectEnvironment",t.ClientAuthError="ClientAuthError",t))(kt||{});const Wt=s(class extends i{state={};constructor(t,e){super(t,e,"Editor Platform Application Context Error")}withUrl(t){return this.state={...this.state,url:t},this}withAppDefinitionId(t){return this.state={...this.state,appDefinitionId:t},this}});class Nt{constructor(t,e,n){this.appDefinitionId=t,this.privateAPI=n,this.events=e,this.subscribe=e.subscribe.bind(e),this.commit=e.commit.bind(e),this.startTransaction=e.startTransaction.bind(e),this.silent=e.silent.bind(e)}events;subscribe;commit;startTransaction;silent;notify(t){this.events.notify({type:t.type,payload:t.payload,meta:{appDefinitionId:this.appDefinitionId}})}notifyCustomEvent(t,e){this.notify({type:p.CustomEvent,payload:{...e,type:t}})}addEventListener(t,e){return this.events.subscribe((async n=>{const i=n.meta?.appDefinitionId===this.appDefinitionId||null===n.meta?.appDefinitionId,s=()=>async function(t,e){if(!t?.type)return t;if("componentSelectionChanged"===t.type){const n=t.componentRefs||[],i=await Promise.all(n.map((t=>e.components.getComponent(t))));return{type:t.type,components:i}}return t}(n.payload,this.privateAPI);"*"===t?e(await s()):n.type===p.CustomEvent?t!==n.payload?.type||i||e(await s()):n.type===p.HostEvent&&t===n.payload?.type&&i&&e(await s())}))}}class $t{_resolveContextInjected=()=>{};_isInjected=!1;key;constructor(t){this.key=`__${t}_CONTEXT_INJECTION_STATUS_KEY`,globalThis[this.key]||(globalThis[this.key]=new Promise((t=>{this._resolveContextInjected=()=>{this._isInjected=!0,t()}})))}isInjected(){return!!this._isInjected}resolveInjected(){this._resolveContextInjected?.()}waitInjected(){return new Promise(((t,e)=>{let n,i=!1,s=0;const o=()=>{i||(n=setTimeout((()=>{if(s++,s<50)return s%10==0&&console.log(Wt(kt.IncorrectEnvironment,"contexts are not resolved, still re-trying").withMessage(`try number ${s}`).message),void o();if(!i){const t=Wt(kt.IncorrectEnvironment,"contexts are not resolved, threw by timeout");e(t)}}),200))};o(),globalThis[this.key].then((()=>{i=!0,clearTimeout(n),t()}))}))}}const Lt="__ENVIRONMENT_CONTEXT_KEY";var Ft=(t=>(t.Worker="Worker",t.Frame="Frame",t.ComponentPanel="ComponentPanel",t))(Ft||{});class Ut{constructor(t){this.environmentContext=t}static status=new $t("environment");static async inject(t){if(globalThis[Lt])throw Wt(kt.IncorrectEnvironment,"Environment context already exists and should not be overridden");globalThis[Lt]=new Ut(t),this.status.resolveInjected()}static async getInstance(){return await this.status.waitInjected(),globalThis[Lt]}getPrivateAPI(){return this.environmentContext.privateApi}getEvents(){return this.environmentContext.events}getApplicationAPIs(){return this.environmentContext.applicationAPIs??{}}getEnvironment(){return this.environmentContext.environment}}const qt="__APPLICATION_CONTEXT_KEY";class Ht{constructor(t,e){this.applicationContext=t,this.environment=e,this.events=new Nt(this.applicationContext.appDefinitionId,this.environment.getEvents(),this.environment.getPrivateAPI())}static status=new $t("application");static async inject(t){if((await Ut.getInstance()).getEnvironment()!==Ft.Frame)throw Wt(kt.IncorrectEnvironment,"Application context can be injected only in frame environment");if(globalThis[qt])throw Wt(kt.IncorrectEnvironment,"Application context already exists and should not be overridden");globalThis[qt]=new Ht(t,await Ut.getInstance()),this.status.resolveInjected()}static async getInstance(){return(await Ut.getInstance()).getEnvironment()===Ft.Frame?(await this.status.waitInjected(),globalThis[qt]):__APPLICATION_CONTEXT_KEY}events;getAppDefinitionId(){return this.applicationContext.appDefinitionId}getBindings(){return this.applicationContext}getEvents(){return this.events}getPrivateAPI(){return this.environment.getPrivateAPI()}getPrivateApplicationAPI(){const t=this.getAppDefinitionId();if(!t)throw Wt(kt.IncorrectEnvironment,"appDefinitionId is not available");return this.environment.getApplicationAPIs()[t]}}s(class extends i{state={};constructor(t,e){super(t,e,"Auth Strategy Error")}withAppDefinitionId(t){return this.state={...this.state,appDefinitionId:t},this}}),"function"==typeof importScripts?(new L).expose(new Ot):(new $).expose(new mt);class Jt{constructor(t,e){this.namespace=t,this.shape=e}build(){return St(Object.fromEntries(Object.entries(this.shape).map((([t,e])=>[t,t=>t?.environmentContext&&t?.applicationContext?e({environmentContext:t.environmentContext,applicationContext:t.applicationContext}):async(...t)=>{const n=await Ut.getInstance(),i=await Ht.getInstance();return e({environmentContext:n,applicationContext:i})(...t)}]))))}}new Jt("application",{getPrivateAPI:({applicationContext:t})=>async()=>t.getPrivateApplicationAPI(),getPublicAPI:({applicationContext:t})=>async e=>t.getPrivateAPI().applicationManager.getPublicApplicationAPI(e),getAppInstance:({applicationContext:t})=>async()=>{const e=t.getPrivateAPI(),n=t.getBindings();return e.info.getAppInstance(n.appDefinitionId)}}).build();var Kt=new Jt("components",{getSelectedComponents:({applicationContext:t})=>async()=>{const e=t.getPrivateAPI(),n=await e.components.getSelectedComponents();return Promise.all(n.map((t=>e.components.getComponent(t))))}}).build();new Jt("events",{addEventListener:({applicationContext:t})=>async(e,n)=>t.getEvents().addEventListener(e,n)}).build(),new Jt("info",{getViewMode:({applicationContext:t})=>async()=>t.getPrivateAPI().info.getViewMode(),getLanguageCode:({applicationContext:t})=>async()=>t.getPrivateAPI().info.getLanguageCode()}).build();var zt=(t=>(t.UndefinedCompRef="UndefinedCompRef",t))(zt||{});const Bt=s(class extends i{constructor(t,e){super(t,e,"Widget Error")}}),Gt=async()=>{const t=await Kt.getSelectedComponents(),e=t[0]?.compRef;if(!e)throw Bt(zt.UndefinedCompRef);return e};var Vt=new Jt("widget",{getProp:({applicationContext:t})=>async e=>{const n=t.getPrivateAPI(),i=await Gt();return n.customElement.getAttribute(i,e)},setProp:({applicationContext:t})=>async(e,n)=>{const i=t.getPrivateAPI(),s=await Gt();await i.customElement.setAttribute(s,e,n)}}).build();const Xt={transformFontInternalValue:t=>{if(t){const{theme:e,...n}=Xt.normalize(t);return{...n,editorKey:e}}return{editorKey:"font_7",family:"helvetica-w01-roman",size:16,style:{}}},transformFontPublicValue:t=>t?{...Xt.normalize(t),theme:t.editorKey}:null,normalize:({theme:t,editorKey:e,preset:n,...i})=>({...i,theme:t??e})};new Jt("inputs",{selectColor:({applicationContext:t})=>async(e,n)=>{const i=t.getPrivateAPI();let s=e?{color:e.color,theme:e?.theme}:null;return await i.inputs.openColorPicker({color:e?.theme?e.theme:e?.color},(({color:t,theme:e})=>{const i={color:t,theme:e};s=i,n?.(i)})),s},selectFont:({applicationContext:t})=>async(e,n,i)=>{const s=t.getPrivateAPI();let o=Xt.transformFontPublicValue(e);return await s.inputs.openFontPicker({...n,componentStyle:Xt.transformFontInternalValue(e)},((...t)=>{((...t)=>{switch(o||(o=Xt.transformFontPublicValue(Xt.transformFontInternalValue(e))),t[0]){case"theme":Object.assign(o,{theme:t[1]});break;case"size":Object.assign(o,{size:t[1]});break;case"bold":Object.assign(o,{style:{...o.style,bold:t[1]}});break;case"italic":Object.assign(o,{style:{...o.style,italic:t[1]}});break;case"underline":Object.assign(o,{style:{...o.style,underline:t[1]}});break;case"family":Object.assign(o,{family:t[1]})}})(...t),i?.(o)})),o}}).build();const Yt=t=>{switch(t){case"get":case"GET":return"GET";case"post":case"POST":return"POST";case"put":case"PUT":return"PUT";case"delete":case"DELETE":return"DELETE";case"patch":case"PATCH":return"PATCH";case"head":case"HEAD":return"HEAD";case"options":case"OPTIONS":return"OPTIONS";default:throw new Error(`Unknown method: ${t}`)}},Qt="www.wixapis.com";Error;const Zt="x-wix-bi-gateway";function te(t){const e=globalThis.__wix_context__,n={client:F.client,elevatedClient:F.elevatedClient};let i;globalThis.__wix_context__=void 0,F.client=void 0,F.elevatedClient=void 0,"undefined"!=typeof $wixContext&&(i={client:$wixContext?.client,elevatedClient:$wixContext?.elevatedClient},delete $wixContext.client,delete $wixContext.elevatedClient);try{return t()}finally{globalThis.__wix_context__=e,F.client=n.client,F.elevatedClient=n.elevatedClient,"undefined"!=typeof $wixContext&&($wixContext.client=i.client,$wixContext.elevatedClient=i.elevatedClient)}}const ee=(t,e,n,i)=>({response:{data:{details:{...!n?.validationError&&{applicationError:{description:e,code:t,data:i}},...n},message:e},status:t}});function ne(){return{emit(t,...e){for(let n=0,i=this.events[t]||[],s=i.length;n<s;n++)i[n](...e)},events:{},on(t,e){return(this.events[t]||=[]).push(e),()=>{this.events[t]=this.events[t]?.filter((t=>e!==t))}}}}function ie(t,e,n,i){let s;if(t.isDomainEvent){const t=n,{deletedEvent:e,actionEvent:o,createdEvent:r,updatedEvent:a,...c}=t,p={...i,...c};s=e?e?.deletedEntity?{entity:e?.deletedEntity,metadata:p}:{metadata:p}:o?{data:o.body,metadata:p}:{entity:r?.entity??a?.currentEntity,metadata:p}}else s={data:n,metadata:i};return e((t.transformations??(t=>t))(s))}!function(t){const e=t.headers||{Authorization:""},n=t.auth||{getAuthHeaders:t=>Promise.resolve({headers:{}})},i=n.getAuthHeaders.bind(void 0,t.host);n.getAuthHeaders=i;const{client:s,initModule:o}=function(t){const e=new Map,n=ne();return{initModule:t=>i=>{const s=e.get(t.componentType.toLowerCase())??[];s.push({servicePluginDefinition:t,implementation:i}),e.set(t.componentType.toLowerCase(),s),n.emit("registered",t)},client:{...n,getRegisteredServicePlugins:()=>e,async parseJWT(e){if(!t.decodeJWT)throw new Error("decodeJWT is not supported by the authentication strategy");const{decoded:n,valid:i}=await t.decodeJWT(e,!0);if(!i)throw new Error("JWT is not valid");if("object"!=typeof n.data||null===n.data||!("metadata"in n.data)||"object"!=typeof n.data.metadata||null===n.data.metadata||!("appExtensionType"in n.data.metadata)||"string"!=typeof n.data.metadata.appExtensionType)throw new Error("Unexpected JWT data: expected object with metadata.appExtensionType string");return n.data},async process(t){const e=await this.parseJWT(t.body);return this.executeHandler(e,t.url)},async parseRequest(t){const e=await t.text();return this.parseJWT(e)},async processRequest(t){const e=t.url,n=await t.text(),i=await this.process({url:e,body:n});return Response.json(i)},async executeHandler(t,n){const i=t.metadata.appExtensionType.toLowerCase(),s=e.get(i)??[];if(0===s.length)throw new Error(`No service plugin implementations found for component type ${i}`);if(s.length>1)throw new Error(`Multiple service plugin implementations found for component type ${i}. This is currently not supported`);const{implementation:o,servicePluginDefinition:r}=s[0],a=r.methods.find((t=>n.endsWith(t.primaryHttpMappingPath)));if(!a)throw new Error("Unexpect request: request url did not match any method: "+n);const c=o[a.name];if(!c)throw new Error(`Got request for service plugin method ${a.name} but no implementation was provided. Available methods: ${Object.keys(o).join(", ")}`);return a.transformations.toREST(await c(a.transformations.fromREST(t)))}}}}(n),{client:r,initModule:a}=function(t){const e=new Map,n=ne();return{initModule:t=>i=>{const s=e.get(t.type)??[];s.push({eventDefinition:t,handler:i}),e.set(t.type,s),n.emit("registered",t)},client:{...n,getRegisteredEvents:()=>e,async process(t,n={expectedEvents:[]}){const{eventType:i,identity:s,instanceId:o,payload:r}=await this.parseJWT(t),a=[...n.expectedEvents,...Array.from(e.keys()).map((t=>({type:t})))];if(a.length>0&&!a.some((({type:t})=>t===i)))throw new Error(`Unexpected event type: ${i}. Expected one of: ${a.map((t=>t.type)).join(", ")}`);const c=e.get(i)??[];return await Promise.all(c.map((({eventDefinition:t,handler:e})=>ie(t,e,r,{instanceId:o,identity:s})))),{instanceId:o,eventType:i,payload:r,identity:s}},async processRequest(t,e){const n=await t.text();return this.process(n,e)},async parseJWT(e){if(!t.decodeJWT)throw new Error("decodeJWT is not supported by the authentication strategy");const{decoded:n,valid:i}=await t.decodeJWT(e);if(!i)throw new Error("JWT is not valid");if("string"!=typeof n.data)throw new Error("Unexpected type of JWT data: expected string, got "+typeof n.data);const s=JSON.parse(n.data),o=s.eventType,r=s.instanceId,a=s.identity?JSON.parse(s.identity):void 0;return{instanceId:r,eventType:o,payload:JSON.parse(s.data),identity:a}},async parseRequest(t){const e=await t.text();return this.parseJWT(e)},async executeHandlers(t){const n=Array.from(e.keys()).map((t=>({type:t})));if(n.length>0&&!n.some((({type:e})=>e===t.eventType)))throw new Error(`Unexpected event type: ${t.eventType}. Expected one of: ${n.map((t=>t.type)).join(", ")}`);const i=e.get(t.eventType)??[];await Promise.all(i.map((({eventDefinition:e,handler:n})=>ie(e,n,t.payload,{instanceId:t.instanceId,identity:t.identity}))))},apps:{AppInstalled:(0,U.EventDefinition)("AppInstalled")(),AppRemoved:(0,U.EventDefinition)("AppRemoved")()}}}}(n),c=async(t,n)=>{const s=await i(),o=(t=>t?.method&&["post","put","patch"].includes(t.method.toLocaleLowerCase())&&t.body?{"Content-Type":"application/json"}:{})(n);return fetch(t,{...n,headers:{...o,...e,...s?.headers,...n?.headers}})},p=(e,n)=>{if("event-definition"===e.__type)return a(e);if("service-plugin-definition"===e.__type)return o(e);var i;if((t=>"host"===t.__type)(e)&&t.host)return function(t,e){return t.create(e)}(e,t.host);if("function"==typeof e){if("__type"in e&&e.__type===U.SERVICE_PLUGIN_ERROR_TYPE)return e;const s=t.host?.apiBaseUrl??Qt;return function(t,e,n,i,s){return te((()=>t({request:async t=>{const i=t({host:s?.HTTPHost||Qt});let o=i;"GET"===o.method&&o.fallback?.length&&o.params.toString().length>4e3&&(o=i.fallback[0]);let r=`https://${s?.HTTPHost??Qt}${o.url}`;o.params&&o.params.toString()&&(r+=`?${o.params.toString()}`);try{const t=function(t,e){return{[Zt]:(n={environment:"js-sdk","package-name":t.packageName??e?.PACKAGE_NAME,"method-fqn":t.methodFqn,entity:t.entityFqdn},Object.entries(n).filter((([t,e])=>Boolean(e))).map((([t,e])=>`${t}=${e}`)).join(","))};var n}(i,e),s=await n(r,{method:o.method,...o.data&&{body:JSON.stringify(o.data)},headers:{...t}});if(200!==s.status){let t=null;try{t=await s.json()}catch(t){}throw ee(s.status,t?.message,t?.details,{requestId:s.headers.get("X-Wix-Request-Id"),details:t})}return{data:await s.json(),headers:s.headers,status:s.status,statusText:s.statusText}}catch(t){throw t.message?.includes("fetch is not defined")&&console.error("Node.js v18+ is required"),t}},fetchWithAuth:n,wixAPIFetch:i})))}(te((()=>(t=>{if(t.__isAmbassador)return!0;const e=t();return Boolean(e.__isAmbassador)})(e)))?(i=e,t=>async e=>{let n;const s=t=>{if(n=i(e)(t),void 0===n.url)throw new Error("Url was not successfully created for this request, please reach out to support channels for assistance.");const{method:s,url:o,params:r}=n;return{...n,method:Yt(s),url:o,data:n.data,params:r}};try{const e=await t.request(s);if(void 0===n)throw new Error("Request options were not created for this request, please reach out to support channels for assistance.");const i=Array.isArray(n.transformResponse)?n.transformResponse:[n.transformResponse];let o=e.data;return i.forEach((t=>{t&&(o=t(e.data,e.headers))})),o}catch(t){if("object"==typeof t&&null!==t&&"response"in t&&"object"==typeof t.response&&null!==t.response&&"data"in t.response)throw t.response.data;throw t}}):e,n??{},c,((t,e)=>{const n=new URL(t,`https://${s}`);return n.host=s,n.protocol="https",c(n.toString(),e)}),{HTTPHost:s})}return(t=>t&&"object"==typeof t&&!Array.isArray(t))(e)?Object.fromEntries(Object.entries(e).map((([t,n])=>[t,p(n,e.__metadata)]))):e};t.modules&&p(t.modules)}({host:{environment:{},channel:{observeState:async()=>({disconnect(){}})}},modules:{widget:Vt}})})();