(()=>{"use strict";var e={};function t(e,t=!1,n=e=>e){return()=>({__type:"event-definition",type:e,isDomainEvent:t,transformations:n})}const n=e=>{switch(e){case"get":case"GET":return"GET";case"post":case"POST":return"POST";case"put":case"PUT":return"PUT";case"delete":case"DELETE":return"DELETE";case"patch":case"PATCH":return"PATCH";case"head":case"HEAD":return"HEAD";case"options":case"OPTIONS":return"OPTIONS";default:throw new Error(`Unknown method: ${e}`)}},s="www.wixapis.com";class o extends Error{message;response;constructor(e,t){super(e),this.message=e,this.response=t}async details(){const e=await this.response.json();return a(this.response.status,e?.message,e?.details,{requestId:this.response.headers.get("X-Wix-Request-Id"),details:e})}}const a=(e,t,n,s)=>({details:{...!n?.validationError&&{applicationError:{description:t,code:e,data:s}},...n},message:t}),i="x-wix-bi-gateway";function r(t){const n=globalThis.__wix_context__,s={client:e.client,elevatedClient:e.elevatedClient};let o;globalThis.__wix_context__=void 0,e.client=void 0,e.elevatedClient=void 0,"undefined"!=typeof $wixContext&&(o={client:$wixContext?.client,elevatedClient:$wixContext?.elevatedClient},delete $wixContext.client,delete $wixContext.elevatedClient);try{return t()}finally{globalThis.__wix_context__=n,e.client=s.client,e.elevatedClient=s.elevatedClient,"undefined"!=typeof $wixContext&&($wixContext.client=o.client,$wixContext.elevatedClient=o.elevatedClient)}}const c=(e,t,n,s)=>({response:{data:{details:{...!n?.validationError&&{applicationError:{description:t,code:e,data:s}},...n},message:t},status:e}});function d(){return{emit(e,...t){for(let n=0,s=this.events[e]||[],o=s.length;n<o;n++)s[n](...t)},events:{},on(e,t){return(this.events[e]||=[]).push(t),()=>{this.events[e]=this.events[e]?.filter((e=>t!==e))}}}}function l(e,t,n,s){let o;if(e.isDomainEvent){const e=n,{deletedEvent:t,actionEvent:a,createdEvent:i,updatedEvent:r,...c}=e,d={...s,...c};o=t?t?.deletedEntity?{entity:t?.deletedEntity,metadata:d}:{metadata:d}:a?{data:a.body,metadata:d}:{entity:i?.entity??r?.currentEntity,metadata:d}}else o={data:n,metadata:s};return t((e.transformations??(e=>e))(o))}function p(a){const p=a.headers||{Authorization:""},h=a.auth||{getAuthHeaders:e=>Promise.resolve({headers:{}})},u=h.getAuthHeaders.bind(void 0,a.host);h.getAuthHeaders=u;const{client:y,initModule:w}=function(e){const t=new Map,n=d();return{initModule:e=>s=>{const o=t.get(e.componentType.toLowerCase())??[];o.push({servicePluginDefinition:e,implementation:s}),t.set(e.componentType.toLowerCase(),o),n.emit("registered",e)},client:{...n,getRegisteredServicePlugins:()=>t,async parseJWT(t){if(!e.decodeJWT)throw new Error("decodeJWT is not supported by the authentication strategy");const{decoded:n,valid:s}=await e.decodeJWT(t,!0);if(!s)throw new Error("JWT is not valid");if("object"!=typeof n.data||null===n.data||!("metadata"in n.data)||"object"!=typeof n.data.metadata||null===n.data.metadata||!("appExtensionType"in n.data.metadata)||"string"!=typeof n.data.metadata.appExtensionType)throw new Error("Unexpected JWT data: expected object with metadata.appExtensionType string");return n.data},async process(e){const t=await this.parseJWT(e.body);return this.executeHandler(t,e.url)},async parseRequest(e){const t=await e.text();return this.parseJWT(t)},async processRequest(e){const t=e.url,n=await e.text(),s=await this.process({url:t,body:n});return Response.json(s)},async executeHandler(e,n){const s=e.metadata.appExtensionType.toLowerCase(),o=t.get(s)??[];if(0===o.length)throw new Error(`No service plugin implementations found for component type ${s}`);if(o.length>1)throw new Error(`Multiple service plugin implementations found for component type ${s}. This is currently not supported`);const{implementation:a,servicePluginDefinition:i}=o[0],r=i.methods.find((e=>n.endsWith(e.primaryHttpMappingPath)));if(!r)throw new Error("Unexpect request: request url did not match any method: "+n);const c=a[r.name];if(!c)throw new Error(`Got request for service plugin method ${r.name} but no implementation was provided. Available methods: ${Object.keys(a).join(", ")}`);return r.transformations.toREST(await c(r.transformations.fromREST(e)))}}}}(h),{client:m,initModule:f}=function(e){const n=new Map,s=d();return{initModule:e=>t=>{const o=n.get(e.type)??[];o.push({eventDefinition:e,handler:t}),n.set(e.type,o),s.emit("registered",e)},client:{...s,getRegisteredEvents:()=>n,async process(e,t={expectedEvents:[]}){const{eventType:s,identity:o,instanceId:a,payload:i}=await this.parseJWT(e),r=[...t.expectedEvents,...Array.from(n.keys()).map((e=>({type:e})))];if(r.length>0&&!r.some((({type:e})=>e===s)))throw new Error(`Unexpected event type: ${s}. Expected one of: ${r.map((e=>e.type)).join(", ")}`);const c=n.get(s)??[];return await Promise.all(c.map((({eventDefinition:e,handler:t})=>l(e,t,i,{instanceId:a,identity:o})))),{instanceId:a,eventType:s,payload:i,identity:o}},async processRequest(e,t){const n=await e.text();return this.process(n,t)},async parseJWT(t){if(!e.decodeJWT)throw new Error("decodeJWT is not supported by the authentication strategy");const{decoded:n,valid:s}=await e.decodeJWT(t);if(!s)throw new Error("JWT is not valid");if("string"!=typeof n.data)throw new Error("Unexpected type of JWT data: expected string, got "+typeof n.data);const o=JSON.parse(n.data),a=o.eventType,i=o.instanceId,r=o.identity?JSON.parse(o.identity):void 0;return{instanceId:i,eventType:a,payload:JSON.parse(o.data),identity:r}},async parseRequest(e){const t=await e.text();return this.parseJWT(t)},async executeHandlers(e){const t=Array.from(n.keys()).map((e=>({type:e})));if(t.length>0&&!t.some((({type:t})=>t===e.eventType)))throw new Error(`Unexpected event type: ${e.eventType}. Expected one of: ${t.map((e=>e.type)).join(", ")}`);const s=n.get(e.eventType)??[];await Promise.all(s.map((({eventDefinition:t,handler:n})=>l(t,n,e.payload,{instanceId:e.instanceId,identity:e.identity}))))},apps:{AppInstalled:t("AppInstalled")(),AppRemoved:t("AppRemoved")()}}}}(h),v=async(e,t)=>{const n=await u(),s=(e=>e?.method&&["post","put","patch"].includes(e.method.toLocaleLowerCase())&&e.body?{"Content-Type":"application/json"}:{})(t);return fetch(e,{...t,headers:{...s,...p,...n?.headers,...t?.headers}})},g=(e,t)=>{if("event-definition"===e.__type)return f(e);if("service-plugin-definition"===e.__type)return w(e);var o;if((e=>"host"===e.__type)(e)&&a.host)return function(e,t){return e.create(t)}(e,a.host);if("function"==typeof e){if("__type"in e&&"wix_spi_error"===e.__type)return e;const d=a.host?.apiBaseUrl??s;return function(e,t,n,o,a){return r((()=>e({request:async e=>{const o=e({host:a?.HTTPHost||s});let r=o;"GET"===r.method&&r.fallback?.length&&r.params.toString().length>4e3&&(r=o.fallback[0]);let d=`https://${a?.HTTPHost??s}${r.url}`;r.params&&r.params.toString()&&(d+=`?${r.params.toString()}`);try{const e=function(e,t){return{[i]:(n={environment:"js-sdk","package-name":e.packageName??t?.PACKAGE_NAME,"method-fqn":e.methodFqn,entity:e.entityFqdn},Object.entries(n).filter((([e,t])=>Boolean(t))).map((([e,t])=>`${e}=${t}`)).join(","))};var n}(o,t),s=await n(d,{method:r.method,...r.data&&{body:JSON.stringify(r.data)},headers:{...e}});if(200!==s.status){let e=null;try{e=await s.json()}catch(e){}throw c(s.status,e?.message,e?.details,{requestId:s.headers.get("X-Wix-Request-Id"),details:e})}return{data:await s.json(),headers:s.headers,status:s.status,statusText:s.statusText}}catch(e){throw e.message?.includes("fetch is not defined")&&console.error("Node.js v18+ is required"),e}},fetchWithAuth:n,wixAPIFetch:o})))}(r((()=>(e=>{if(e.__isAmbassador)return!0;const t=e();return Boolean(t.__isAmbassador)})(e)))?(o=e,e=>async t=>{let s;const a=e=>{if(s=o(t)(e),void 0===s.url)throw new Error("Url was not successfully created for this request, please reach out to support channels for assistance.");const{method:a,url:i,params:r}=s;return{...s,method:n(a),url:i,data:s.data,params:r}};try{const t=await e.request(a);if(void 0===s)throw new Error("Request options were not created for this request, please reach out to support channels for assistance.");const n=Array.isArray(s.transformResponse)?s.transformResponse:[s.transformResponse];let o=t.data;return n.forEach((e=>{e&&(o=e(t.data,t.headers))})),o}catch(e){if("object"==typeof e&&null!==e&&"response"in e&&"object"==typeof e.response&&null!==e.response&&"data"in e.response)throw e.response.data;throw e}}):e,t??{},v,((e,t)=>{const n=new URL(e,`https://${d}`);return n.host=d,n.protocol="https",v(n.toString(),t)}),{HTTPHost:d})}return(e=>e&&"object"==typeof e&&!Array.isArray(e))(e)?Object.fromEntries(Object.entries(e).map((([t,n])=>[t,g(n,e.__metadata)]))):e};return{...a.modules?g(a.modules):{},auth:h,setHeaders:e=>{for(const t in e)p[t]=e[t]},use:g,enableContext(t,n={elevated:!1}){"global"===t?null!=globalThis.__wix_context__?n.elevated?globalThis.__wix_context__.elevatedClient=this:globalThis.__wix_context__.client=this:n.elevated?globalThis.__wix_context__={elevatedClient:this}:globalThis.__wix_context__={client:this}:n.elevated?e.elevatedClient=this:e.client=this},fetch:(e,t)=>{const n=a.host?.apiBaseUrl??s,o=new URL(e,`https://${n}`);return o.host=n,o.protocol="https",v(o.toString(),t)},fetchWithAuth:async(e,t)=>{if("string"==typeof e||e instanceof URL)return fetch(e,{...t,headers:{...t?.headers,...(await u()).headers}});for(const[t,n]of Object.entries((await u()).headers))e.headers.set(t,n);return fetch(e,t)},async graphql(e,t,n={apiVersion:"alpha"}){const i=a?.host?.apiBaseUrl??s,r=await v(`https://${i}/graphql/${n.apiVersion}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:e,variables:t})});if(200!==r.status)throw new o(`GraphQL request failed with status ${r.status}`,r);const{data:c,errors:d}=await r.json();return{data:c??{},errors:d}},webhooks:m,servicePlugins:y}}const h=e=>{let{clientSdk:t,applicationId:n}=e;return{invoke:async e=>{let{namespace:s,method:o,args:a}=e;return t.invoke({namespace:s,method:o,args:a,applicationId:n,accessToken:"accessToken"})},getAccessToken:()=>{throw new Error("Not implemented")},observeState:()=>({disconnect:()=>{}})}},u=(e=>{let{createHost:t}=e;return{__type:"host",create:e=>({}),host:t,auth:e=>{const t="undefined"!=typeof window?window.wixEmbedsAPI:void 0;e||(e=null==t||null==t.getAccessTokenFunction?void 0:t.getAccessTokenFunction());let n=!1;const{resolve:s,promise:o}=function(){let e=null,t=null;return{promise:new Promise(((n,s)=>{e=n,t=s})),resolve:e,reject:t}}();return{getAuthHeaders:async()=>{if(!e&&n&&(e=await o),!e)throw new Error("Failed to resolve auth token");return{headers:{Authorization:await e()}}},createInjector:()=>(n=!0,e=>{s(e)})}}}})({createHost:function(e){const t="undefined"!=typeof $wixContext&&$wixContext.clientSdk||(null==e?void 0:e.clientSdk)||window.clientSdk,{applicationId:n}=e||{};if(!n)throw new Error('"createHost" was called without a required field "applicationId"');if(!t)throw new Error("Wix Site SDK only works in a Wix site environment. Learn more: https://dev.wix.com/docs/sdk/host-modules/site/introduction");return{channel:h({clientSdk:t,applicationId:n}),close:()=>{}}}});class y extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.container=document.createElement("div"),this.container.style.padding="10px",this.shadowRoot.appendChild(this.container),this.textElement=document.createElement("span"),this.container.appendChild(this.textElement),this.setColor(this.getAttribute("color")),this.setTextContent("init")}static get observedAttributes(){return["color","bookingsserviceid"]}async attributeChangedCallback(e,t,n){if("color"===e&&t!==n)console.log("Color attribute changed"),this.setColor(n);else if("bookingsserviceid"===e&&t!==n){let e=(await wixClient.bookings.getServiceAvailability(bookingsserviceid)).slots[0];console.log(e),this.setTextContent("Fist slot: "+JSON.stringify(e))}}accessTokenListener(e){const t=p({host:u.host({applicationId:"7dea53d2-fbd3-463a-990a-22216a7cfb35"}),auth:u.auth(e),modules:{services}});console.log("createClient",t)}setColor(e){this.container.style.backgroundColor=e||"gray"}setTextContent(e){this.textElement.textContent=e||""}}customElements.define("ce-josh",y)})();